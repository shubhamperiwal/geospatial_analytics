---
title: "Project - Initial Plots"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE)
```


```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
packages = c('sf', 'tmap', 'ggmap', 'rgdal', 'tidyverse')
for (p in packages){ 
  if(!require(p, character.only = T)){
    install.packages(p) 
  }
  library(p,character.only = T) 
}
```

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
houses <- read_csv('data/resale-flat-prices/all_flats.csv')
mpsz <- readOGR(dsn='data/mpsz', layer='MP14_SUBZONE_WEB_PL')
houses_sf <- st_as_sf(houses, coords = c("lon", "lat"))
```

## BUS STOP 

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
busStop <- readOGR(dsn='data/BusStop', layer='BusStop')

busStop.data <- busStop@data
busStop.data <- distinct(busStop@data, 'BUS_sTOP_N')
```

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
#Setting an interactive view mode of tmap
tmap_mode("view")

tm_shape(mpsz) + 
  tm_polygons() + 
  tm_shape(busStop) + 
  tm_dots(size = 0.000001, col = "#7d4627") + 
  tm_style("classic", bg.color="white") +
  tm_view(alpha = 1, basemaps = "Stamen.Watercolor")


```

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
#BUS STOP AND HOUSES
tmap_mode('plot')
tm_shape(mpsz) + tm_style("classic", bg.color="white") + tm_polygons() + 
  tm_shape(houses_sf) + tm_bubbles(col='flat_type') +
  tm_shape(busStop) + tm_dots()

```

## TAXI STOP

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
taxiStop <- readOGR(dsn='data/taxistand', layer='TaxiStop')
```

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
#Setting an interactive view mode of tmap
tmap_mode("view")

tm_shape(mpsz) + tm_polygons() +
  tm_shape(taxiStop) + tm_dots(size = 0.01, col = "#7d4627") + 
  tm_style("classic", bg.color="white") +
  tm_view(alpha = 1, basemaps = "Stamen.Watercolor")
```

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
#For all KML files
ogrListLayers("data/clinics/MOH_CHAS_CLINICS.kml")
clinics <- readOGR(dsn="data/clinics/MOH_CHAS_CLINICS.kml", layer="MOH_CHAS_CLINICS")
```
```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
tm_shape(mpsz) + tm_polygons() +
  tm_shape(clinics) + tm_dots(size = 0.001, col = "#7d4627") + 
  tm_style("classic", bg.color="white") +
  tm_view(alpha = 1, basemaps = "Stamen.Watercolor")
```

## HAWKER CENTRES 

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
ogrListLayers("data/hawker-centres/hawker-centres-kml.kml")
hawker_centres <- readOGR(dsn="data/hawker-centres/hawker-centres-kml.kml", layer="HAWKERCENTRE")
```



```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
tm_shape(mpsz) + tm_polygons() +
  tm_shape(hawker_centres) + tm_dots(size = 0.01, col = "#7d4627") + 
  tm_style("classic", bg.color="white") +
  tm_view(alpha = 1, basemaps = "Stamen.Watercolor")
```

## MRT STATION

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
ogrListLayers("data/mrtstation/lta-mrt-station-exit-kml.kml")
mrt_station <- readOGR(dsn="data/mrtstation/lta-mrt-station-exit-kml.kml", layer="MRT_EXITS")
```

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
tm_shape(mpsz) + tm_polygons() +
  tm_shape(mrt_station) + tm_dots(size = 0.01, col = "#7d4627") + 
  tm_style("classic", bg.color="white") +
  tm_view(alpha = 1, basemaps = "Stamen.Watercolor")
```

## Pre-SCHOOLS

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
ogrListLayers("data/schools/pre-schools-location-kml.kml")
pre_schools <- readOGR(dsn="data/schools/pre-schools-location-kml.kml", layer="PRESCHOOLS_LOCATION")
```

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
tm_shape(mpsz) + tm_polygons() +
  tm_shape(pre_schools) + tm_dots(size = 0.001, col = "#7d4627") + 
  tm_style("classic", bg.color="white") +
  tm_view(alpha = 1, basemaps = "Stamen.Watercolor")
```

## SINGAPORE POLICE FORCE ESTABLISHMENT 

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
ogrListLayers("data/singapore-police-force-establishment/singapore-police-force-establishments-2018-kml.kml")
singapore_police <- readOGR(dsn="data/singapore-police-force-establishment/singapore-police-force-establishments-2018-kml.kml", layer="SPF_ESTABLISHMENTS_2018")
```

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
tm_shape(mpsz) + tm_polygons() +
  tm_shape(singapore_police) + tm_dots(size = 0.01, col = "#7d4627") + 
  tm_style("classic", bg.color="white") +
  tm_view(alpha = 1, basemaps = "Stamen.Watercolor")
```

#Plot Choropleth Map 

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mrt <- read_csv('data/mrtstation/mrt.csv')

mrts_sf <- st_as_sf(mrt, coords=c("lon", "lat"))
mrts_sf <- st_set_crs(mrts_sf, 4326)
mrts_sf <- st_transform(mrts_sf, 3414)

facilities_agg <- mrts_sf %>% group_by(SUBZONE_N) %>% summarise(count = n())

mpsz <- readOGR(dsn='data/mpsz', layer='MP14_SUBZONE_WEB_PL')
mpr <- readOGR(dsn='data/mp_region/MP14_REGION_WEB_PL.kml', layer='MP14_REGION_WEB_PL')
mpa <- readOGR(dsn='data/mp_planning_area/MP14_PLNG_AREA_WEB_PL.kml', layer='MP14_PLNG_AREA_WEB_PL')

```

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
mpsz_data <- mpsz@data
mpsz_count <- left_join(mpsz_data, facilities_agg)
mpsz_count$count[is.na(mpsz_count$count)] <- 0
mpsz@data <- mpsz_count

mydata <-tm_shape(mpsz) +tm_fill("count", style = "jenks", palette = "GnBu", title = "Count of Facility") +
  tm_layout(legend.show = FALSE,title.position = c("center", "center"), title.size = 20) +
  tm_borders(alpha = 0.5) 

tmap_leaflet(mydata)

  
```

