packages = c('sf', 'rgdal', 'tidyverse', 'qdapTools', 'spatstat', 'readr', 'raster')
for (p in packages){
if(!require(p, character.only = T)){
install.packages(p)
}
library(p,character.only = T)
}
houses <- read_csv('data/resale-flat-prices/all_flats_updated.csv')
houses_sf <- st_as_sf(houses, coords = c("lon", "lat"))
houses_sf <- st_set_crs(houses_sf, 4326)
houses_sf <- st_transform(houses_sf, 3414)
ogrListLayers('data/busstop')
busStops <- readOGR(dsn='data/busstop', layer='BusStop')
busStops_st <- st_read(dsn='data/busstop', layer='BusStop')
View(busStops_st)
ogrListLayers('data/BusStopLocation_Jan2019/')
setwd("C:/IS415/Project/geospatial_analytics")
ogrListLayers('data/BusStopLocation_Jan2019/')
ogrListLayers('data/BusStopLocation_Jan2019')
busStops <- readOGR(dsn='data/BusStopLocation_Jan2019', layer='BusStop')
View(busStops)
busStops_st <- st_read(dsn='data/busstop', layer='BusStop')
View(busStops_st)
ogrListLayers('data/BusStopLocation_Jan2019')
ogrListLayers('data/BusStopLocation_Jan2019/')
ogrListLayers('data/BusStopLocation_Jan2019/bus-stops.kml')
busStops <- readOGR(dsn='data/BusStopLocation_Jan2019/bus-stops.kml', layer='Layer #0')
View(busStops)
yo <- busStops@data
View(yo)
yo <- busStops@coords
View(yo)
st_crs(busStops)
busStops_sf <- st_as_sf(busStops)
busStops_sf <- st_transform(busStops_sf, 3414)
View(busStops_sf)
View(houses_sf)
busStops_buffer <- st_buffer(houses_sf, 500)
busStops_in_range <- st_intersection(busStops_buffer, busStops_sf)
busStops_in_range <- st_intersection(busStops_buffer, busStops_sf)
#Get num of houses with busStops in 2km
length(unique(busStops_in_range$X1))
busStops_buffer <- st_buffer(houses_sf, 300)
busStops_in_range <- st_intersection(busStops_buffer, busStops_sf)
busStops_in_range <- st_intersection(busStops_buffer, busStops_sf)
#Get num of houses with busStops in 2km
length(unique(busStops_in_range$X1))
busStops_coords <- as.data.frame(st_coordinates(busStops_in_range))
busStops_in_range$busStop_x <- busStops_coords$X
busStops_in_range$busStop_y <- busStops_coords$Y
houses_coords <- as.data.frame(st_coordinates(houses_sf))
houses_coords$X1 <- houses_sf$X1
houses_coords$X1 <- houses_sf$X1
colnames(houses_coords) <- c("house_x", "house_y", "X1")
busStops_in_range_join <- inner_join(busStops_in_range, houses_coords, by="X1")
#Get distance now
#function to get euclidean distance between 2 points
getDistance <- function( df ){
return(pointDistance(c(df$house_x, df$house_y),
c(df$busStop_x, df$busStop_y),
lonlat=FALSE))
}
#Apply function to each row
busStops_in_range_join$dist <- apply(busStops_in_range_join,1,getDistance)
#Group by house and keep the min distance
houses_with_min_dist <- busStops_in_range_join %>% group_by(X1) %>% summarise(min_dist_busStop = min(dist))
all_house_ids <- houses$X1
min_dist_found_ids <- houses_with_min_dist$X1
min_dist_not_found_ids <- setdiff(all_house_ids, min_dist_found_ids)
min_dist_not_found_sf <- houses_sf[houses_sf$X1 %in% min_dist_not_found_ids,]
busStops_buffer_far <- st_buffer(min_dist_not_found_sf, 500)
busStops_in_range_far <- st_intersection(busStops_buffer_far, busStops_sf)
length(unique(busStops_in_range_far$X1))
busStops_coords_far <- as.data.frame(st_coordinates(busStops_in_range_far))
busStops_in_range_far$busStop_x <- busStops_coords_far$X
busStops_in_range_far$busStop_y <- busStops_coords_far$Y
houses_far_coords <- as.data.frame(st_coordinates(min_dist_not_found_sf))
houses_far_coords$X1 <- min_dist_not_found_sf$X1
colnames(houses_far_coords) <- c("house_x", "house_y", "X1")
busStops_in_range_far_join <- inner_join(busStops_in_range_far, houses_far_coords, by="X1")
#function to get euclidean distance between 2 points
getDistance <- function( df ){
return(pointDistance(c(df$house_x, df$house_y),
c(df$busStop_x, df$busStop_y),
lonlat=FALSE))
}
#Apply function to each row
busStops_in_range_far_join$dist <- apply(busStops_in_range_far_join,1,getDistance)
#Group by house and keep the min distance
houses_with_min_dist_far <- busStops_in_range_far_join %>% group_by(X1) %>% summarise(min_dist_busStop = min(dist))
houses_all_with_min_dist <- rbind(houses_with_min_dist, houses_with_min_dist_far)
houses_all_with_min_dist <- rbind(houses_with_min_dist, houses_with_min_dist_far)
houses_final <- inner_join(houses, houses_all_with_min_dist, by='X1')
houses_final <- houses_final %>% dplyr::select(-geometry)
View(houses_final)
write_csv(houses_final, 'data/resale-flat-prices/all_flats_updated.csv')
ogrListLayers('data/busStops/bus-stops.kml')
busStops <- readOGR(dsn='data/busStops/bus-stops.kml', layer='Layer #0')
busStops_sf <- st_as_sf(busStops)
busStops_sf <- st_transform(busStops_sf, 3414)
